{% extends 'incidents/base.html' %}
{% load static %}
{% block title %}All reports{% endblock %}
{% block content %}
        <div class="container py-2">
            <h1 class="mb-4 text-center">All Reports</h1>
                <div class="form-wrapper mb-5 shadow-sm rounded p-4">
                    <form action="{% url 'incidents:all_reports_view' %}" method="GET" class="row g-3 align-items-end">
                        <div class="col-md-4">
                            <label for="search" class="form-label fw-bold">Search</label>
                            <input type="search" class="form-control" value="{{request.GET.search}}" name="search" placeholder="Title or Category" />
                        </div>
                        <div class="col-md-3">
                            <label class="form-label fw-bold">Category</label>
                            <select class="form-select" name="category">
                                            <option value="">All Category</option>
                                            <option value="public_safety" {% if request.GET.category == "public_safety" %}selected{% endif %}>Public Safety</option>
                                            <option value="road_damage" {% if request.GET.category == "road_damage" %}selected{% endif %}>Road Damage</option>
                                            <option value="vandalism" {% if request.GET.category == "vandalism" %}selected{% endif %}>Vandalism</option>
                                            <option value="sanitation" {% if request.GET.category == "sanitation" %}selected{% endif %}>Sanitation</option>
                                            <option value="lighting" {% if request.GET.category == "lighting" %}selected{% endif %}>Lighting</option>
                                            <option value="other" {% if request.GET.category == "other" %}selected{% endif %}>Other</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                                <label class="form-label fw-bold">Status</label>
                                <select name="status" class="form-select">
                                    <option value="">All Statuses</option>
                                    <option value="open" {% if request.GET.status == 'open'%} selected {% endif %}>Open</option>
                                    <option value="closed" {% if request.GET.status == 'closed'%} selected {% endif %}>Closed</option>
                                </select>
                        </div>
                        <div class="col-md-2 d-grid">
                                <input type="submit" value="apply" class="btn btn-primary"/>
                        </div>

                    </form>
                </div>
                <hr class="my-4">
                {% if incidents %}
                    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-col-lg-4 g-4">
                        {% for incident in incidents %}
                            <div class="col">
                                <div class="card h-100 shadow-sm">
                                    {% if incident.image %}
                                        <img src="{{incident.image.url}}" class="card-img-top rounded-top" style="height: 200px; object-fit: cover;" alt="incident image">
                                    {% endif %}
                                    <div class="card-body">
                                        <h5 class="card-title text-primary">{{incident.title}}</h5> 
                                        <p class="card-text mb-1">Reported by: <strong>üë§{{incident.reporter_name}}</strong></p>
                                        <p class="card-text mb-1">üèÖRank: 
                                            {% with incident.reporter_rank as rank %}
                                                {% if rank == "Gold" %}
                                                    <span class="badge bg-warning text-dark" title="10+ reports">
                                                        <img src="{% static 'images/gold-medal.png' %}" width="20" class="me-1"><strong>Gold</strong>
                                                    </span>
                                                {% elif rank == "Silver" %}
                                                    <span class="badge bg-secondary" title="5+ reports">
                                                        <img src="{% static 'images/silver-medal.png' %}" width="20" class="me-1"><strong>Silver</strong>
                                                    </span>
                                                {% else %}
                                                    <span class="badge bg-bronze text-light" style="background-color: rgb(187, 133, 34);" title="less than 5 reports">
                                                        <img src="{% static 'images/bronze-medal.png' %}" width="20" class="me-1"><strong>Bronze</strong>
                                                    </span>
                                                {% endif %}
                                            {% endwith %}
                                        </p>
                                        <p class="card-text">{{incident.category}}</p>
                                        <a href="{% url 'incidents:incidents_details_view' incident.id %}" class="btn btn-outline-primary btn-sm">Brief about the report</a>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                </div>
            {% else %}
                <p class="bg-warning p-3 rounded mt-4 text-center">No results found for "{{request.GET.search}}"</p>
            {% endif %}
        </div>

{% endblock %}